<div class="dashboard">
  <div class="dashboard__header">
    <h1>Dashboard</h1>
    <div class="dashboard__actions">
      <a class="btn ghost" routerLink="/expenses">Expenses</a>
      <a class="btn" routerLink="/bills">Bills</a>
    </div>
  </div>

  <div class="stats" *ngIf="!loading; else loadingTpl">
    <div class="stat">
      <div class="label">Total expenses</div>
      <div class="value">{{ totalExpenses | number:'1.2-2' }}</div>
      <div class="delta up">This month</div>
    </div>
    <div class="stat stat--action" (click)="openUpcomingModal()" tabindex="0" role="button" aria-label="View upcoming bills">
      <div class="label">Upcoming bills (7 days)</div>
      <div class="value">{{ upcomingBillsCount }}</div>
      <div class="delta down">Due soon</div>
    </div>
    <div class="stat">
      <div class="label">Categories</div>
      <div class="value">—</div>
      <div class="delta">Overview</div>
    </div>
    <div class="stat">
      <div class="label">Average daily spend</div>
      <div class="value">—</div>
      <div class="delta">Last 30 days</div>
    </div>
  </div>
  <ng-template #loadingTpl>
    <p>Loading…</p>
  </ng-template>

  <div class="alert error" *ngIf="error">{{ error }}</div>

  <div class="panel">
    <div class="panel__header">
      <h3>Spending by category</h3>
    </div>
    <div class="panel__body chart">
      <app-spending-by-category-chart
        [data]="monthSlices"
        [monthTotal]="monthTotal"
        (categorySelected)="onCategorySelected($event)"></app-spending-by-category-chart>
      <div>
        <a class="btn ghost" routerLink="/expenses">View expense details</a>
      </div>
    </div>
  </div>

  <!-- Modal: Upcoming bills -->
  <div class="modal" *ngIf="showUpcomingModal">
    <div class="modal__backdrop" (click)="closeUpcomingModal()"></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-label="Upcoming bills">
      <div class="modal__header">
        <h3>Upcoming bills</h3>
        <button type="button" class="modal__close" (click)="closeUpcomingModal()" aria-label="Close">✕</button>
      </div>
      <div class="modal__body">
        <div *ngIf="upcomingBills?.length; else noneTpl">
          <ul class="modal__list">
            <li *ngFor="let b of upcomingBills">
              <span class="date">{{ b.dueDate | date:'mediumDate' }}</span>
              <span class="name">{{ b.name }}</span>
              <span class="amount">{{ b.amount | number:'1.2-2' }}</span>
            </li>
          </ul>
        </div>
        <ng-template #noneTpl>
          <p class="hint">No upcoming bills in the next 7 days.</p>
        </ng-template>
      </div>
      <div class="modal__footer">
        <button type="button" class="btn" (click)="closeUpcomingModal()">Close</button>
      </div>
    </div>
  </div>
</div>
